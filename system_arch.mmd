---
title: VLM Image Recognition System Architecture
---
flowchart TD
    %% Input Layer
    A["`ðŸ–¼ï¸ **Input Image**
    (JPG/PNG)`"] --> B{"`ðŸ“ **Image Processing**
    Resize & Quality Control`"}
    
    %% Image Processing
    B --> C["`ðŸ“ **Calculate Dimensions**
    RESIZE_WIDTH: 256px
    LOCAL_RESIZE_COEFFICIENT: 1.0
    Maintain Aspect Ratio`"]
    
    %% Mode Selection
    C --> D{"`âš™ï¸ **Processing Mode**
    --local flag?`"}
    
    %% Cloud Path
    D -->|Cloud Mode| E["`â˜ï¸ **X.AI Grok-4 VLM**
    API Endpoint
    Vision Analysis`"]
    
    %% Local Path
    D -->|Local Mode| F["`ðŸ  **Ollama LLaVA**
    Local Processing
    Proxy Bypass`"]
    
    %% API Configuration
    E --> G["`ðŸ”‘ **Cloud Config**
    XAI_API_KEY
    Quality: 85
    Timeout: 30s`"]
    
    F --> H["`ðŸ”§ **Local Config**
    localhost:11434
    No Proxy
    Timeout: 60s`"]
    
    %% Processing
    G --> I["`ðŸ§  **VLM Analysis**
    Object Detection
    Coordinate Extraction
    Confidence Scoring`"]
    
    H --> I
    
    %% Response Processing
    I --> J{"`ðŸ“‹ **Parse Response**
    Markdown Table Format
    Valid Coordinates?`"}
    
    J -->|Success| K["`âœ… **Object Detection**
    Extract H,V Coordinates
    Parse Object Labels
    Calculate Confidence`"]
    
    J -->|Failure| L["`âŒ **Error Handling**
    Log Parsing Error
    Generate Fallback Response`"]
    
    %% Coordinate Processing
    K --> M["`ðŸ“ **Coordinate Scaling**
    Scale from Processed to Original
    Maintain Aspect Ratio
    Dynamic Resolution Mapping`"]
    
    %% Visualization
    M --> N["`â­ **Visual Markers**
    Draw Stars at Coordinates
    Annotate Object Labels
    Apply Visual Feedback`"]
    
    %% Output Generation
    N --> O["`ðŸ’¾ **Save Results**
    annotated_output.jpg
    Preserve Original + Markers`"]
    
    L --> P["`ðŸ”Š **Audio Feedback**
    Text-to-Speech
    Result Announcement`"]
    
    O --> P
    
    %% Logging
    P --> Q["`ðŸ“ **Comprehensive Logging**
    Timing Information
    Detection Results
    Error Tracking`"]
    
    %% Final Output
    Q --> R["`ðŸ“¤ **Output Complete**
    Console Results
    Annotated Image
    Audio Confirmation`"]

    %% Subgraph for Cloud Processing
    subgraph Cloud ["`â˜ï¸ **Cloud Processing Path**`"]
        E
        G
    end
    
    %% Subgraph for Local Processing
    subgraph Local ["`ðŸ  **Local Processing Path**`"]
        F
        H
    end
    
    %% Subgraph for Core Processing
    subgraph Core ["`ðŸŽ¯ **Core VLM Processing**`"]
        I
        J
        K
        M
    end
    
    %% Subgraph for Output Pipeline
    subgraph Output ["`ðŸ“Š **Output Pipeline**`"]
        N
        O
        P
        Q
        R
    end

    %% Chinese Translation Engine
    subgraph Chinese_Translation_Engine ["`ðŸ‡¨ðŸ‡³ **Chinese Translation Engine**`"]
        D["`ðŸ”„ **Chinese Translation**
    Detect Language
    Translate to English`"]
        E["`ðŸ“š **Pattern Matching**
    Analyze Sentence Structure
    Match with Object Dictionary`"]
        F["`ðŸ”¤ **Object Translation**
    Translate Detected Objects
    Map to English Equivalents`"]
        
        II["`ðŸ“‹ **Command Patterns**
    è¯·.*?æ‹¿.*?ç»™æˆ‘
    å¸®æˆ‘.*?æ‹¿.*
    æ‰¾.*?ç»™æˆ‘`"]
        
        JJ["`ðŸ“– **Object Dictionary**
    å¯ä¹â†’coke
    è‹¹æžœâ†’apple
    ä¹¦â†’book`"]
        
        D --> E
        E --> F
        II --> E
        JJ --> F
    end
    
    %% VLM Processing Pipeline
    subgraph VLM_Processing_Pipeline ["`ðŸš€ **VLM Processing Pipeline**`"]
        K["`â˜ï¸ **Grok-4 Cloud**
    High Accuracy
    English Optimized`"]
        L["`â˜ï¸ **Qwen-VL Cloud**
    Chinese Optimized
    Good Accuracy`"]
        M["`ðŸ  **LLaVA Local**
    Privacy Focused
    Free Processing`"]
        
        FF["`ðŸ” **Grok-4 API**
    Analyze Image
    Generate Response`"]
        GG["`ðŸ” **Qwen-VL API**
    Analyze Image
    Generate Response`"]
        HH["`ðŸ” **LLaVA Local API**
    Analyze Image
    Generate Response`"]
        
        K --> FF
        L --> GG
        M --> HH
    end
    
    %% Image Processing
    subgraph Image_Processing ["`ðŸ–¼ï¸ **Image Processing**`"]
        Q["`ðŸ“ **Original Resolution**
    95% Quality
    Base64 Encoding`"]
        R["`ðŸ“ **Local Resize**
    85% Quality
    Optimized Size`"]
        
        KK["`ðŸ”„ **Base64 Decode**
    Convert to Image
    Prepare for VLM`"]
        LL["`ðŸ“ **Image Resizing**
    Adjust to VLM Specs
    Maintain Quality`"]
        
        Q --> KK
        R --> LL
    end
    
    %% Output Generation
    subgraph Output_Generation ["`ðŸ“¤ **Output Generation**`"]
        AA["`ðŸ”Š **Text-to-Speech**
    Announce Results
    Object Found/Not Found`"]
        BB["`â­ **Visual Annotation**
    Overlay Stars
    Annotate Objects`"]
        CC["`ðŸ’» **macOS Say Command**
    Execute TTS
    System Voice`"]
        DD["`ðŸŸ¡ **Yellow Star Overlay**
    Draw Stars on Image
    Indicate Coordinates`"]
        EE["`ðŸ–¥ï¸ **Image Display**
    Show Processed Image
    With Annotations`"]
        
        AA --> CC
        BB --> DD
        DD --> EE
    end
    
    %% Styling
    classDef input fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef processing fill:#f3e5f5,stroke:#8e24aa,stroke-width:2px
    classDef cloud fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef local fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef core fill:#fce4ec,stroke:#d81b60,stroke-width:2px
    classDef output fill:#f9fbe7,stroke:#689f38,stroke-width:2px
    classDef error fill:#ffebee,stroke:#f44336,stroke-width:2px
    
    class A,B,C input
    class D,E,F processing
    class G cloud
    class H local
    class I,J,K,M core
    class N,O,P,Q,R output
    class L error
```
